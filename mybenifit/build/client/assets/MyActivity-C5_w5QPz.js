import{R as m,j as e,w as ie,r as d}from"./chunk-EF7DTUVF-Boj4Qu73.js";import{a as G}from"./firebase-Db5tcxcc.js";import{e as v,f as ae}from"./firestore-yvp8jBDT.js";import{N as re}from"./nav-CVT91Aez.js";const u=m.forwardRef(({className:s,variant:a,size:i,...h},b)=>{const y="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",f={default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},c={default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"};return e.jsx("button",{className:`${y} ${f[a||"default"]} ${c[i||"default"]} ${s||""}`,ref:b,...h})});u.displayName="Button";const j=m.forwardRef(({className:s,type:a,...i},h)=>e.jsx("input",{type:a,className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${s||""}`,ref:h,...i}));j.displayName="Input";const g=m.forwardRef(({className:s,...a},i)=>e.jsx("label",{ref:i,className:`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${s||""}`,...a}));g.displayName="Label";const ne=({children:s,...a})=>e.jsx("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",...a,children:s}),J=m.forwardRef(({className:s,...a},i)=>e.jsx("textarea",{className:`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${s||""}`,ref:i,...a}));J.displayName="Textarea";const k=m.forwardRef(({className:s,...a},i)=>e.jsx("div",{ref:i,className:`rounded-xl border bg-card text-card-foreground shadow ${s||""}`,...a}));k.displayName="Card";const z=m.forwardRef(({className:s,...a},i)=>e.jsx("div",{ref:i,className:`flex flex-col space-y-1.5 p-6 ${s||""}`,...a}));z.displayName="CardHeader";const S=m.forwardRef(({className:s,...a},i)=>e.jsx("h3",{ref:i,className:`font-semibold leading-none tracking-tight ${s||""}`,...a}));S.displayName="CardTitle";const P=m.forwardRef(({className:s,...a},i)=>e.jsx("div",{ref:i,className:`p-6 pt-0 ${s||""}`,...a}));P.displayName="CardContent";const le=m.forwardRef(({className:s,...a},i)=>e.jsx("p",{ref:i,className:`text-sm text-muted-foreground ${s||""}`,...a}));le.displayName="CardDescription";function oe(){const[s,a]=d.useState(G.currentUser),[i,h]=d.useState([]),[b,y]=d.useState(!1),[f,c]=d.useState(""),[H,n]=d.useState(""),[D,C]=d.useState("Running"),[N,A]=d.useState(""),[T,F]=d.useState(""),[L,E]=d.useState(""),[w,B]=d.useState(""),[I,R]=d.useState(new Date().toISOString().split("T")[0]),[U,M]=d.useState(!1),[x,W]=d.useState(null),[$,K]=d.useState("all");d.useEffect(()=>{const t=G.onAuthStateChanged(r=>{console.log("Auth state changed:",r?`User ${r.uid} signed in`:"User signed out"),a(r),r&&console.log("User details:",{uid:r.uid,email:r.email,displayName:r.displayName,emailVerified:r.emailVerified})});return()=>t()},[]),d.useEffect(()=>{let t;return s?(Y(),t=v.subscribeToUserExtendedActivities(s.uid,r=>{h(r),(f.includes("No activities found")||f.includes("Successfully loaded"))&&c("")})):(h([]),c(""),n("")),()=>{t&&t()}},[s]);const Y=async()=>{if(!s){n("User not authenticated. Please sign in to view your activities.");return}try{y(!0),n(""),c(""),console.log("Loading activities for user:",s.uid);const t=await v.getExtendedActivitiesByUser(s.uid);console.log("Loaded activities:",t),h(t),t.length===0?c("No activities found. Log your first activity to get started!"):(c(`Successfully loaded ${t.length} activit${t.length===1?"y":"ies"}`),setTimeout(()=>c(""),3e3))}catch(t){console.error("Error loading activities:",t),t instanceof Error?t.message.includes("permission")?n("Permission denied. Please check your authentication status and Firestore security rules."):t.message.includes("network")?n("Network error. Please check your internet connection."):n(`Failed to load activities: ${t.message}`):n("Failed to load activities. Please try refreshing the page.")}finally{y(!1)}},Q=async t=>{if(t.preventDefault(),n(""),c(""),!s){n("Please sign in to log activities");return}if(!D.trim()){n("Please select an activity type.");return}if(isNaN(parseFloat(N))||parseFloat(N)<=0){n("Please provide a valid, positive duration in minutes.");return}const r=new Date(I),p=new Date;if(p.setHours(23,59,59,999),r>p){n("Activity date cannot be in the future.");return}const o={userId:s.uid,activityType:D,duration:parseFloat(N),date:ae.toTimestamp(new Date(I))};T.trim()!==""&&(o.distance=parseFloat(T)),L.trim()!==""&&(o.caloriesBurned=parseFloat(L)),w.trim()!==""&&(o.notes=w);try{if(M(!0),x){if(!x.id){n("Cannot update activity: ID is missing.");return}await v.updateExtendedActivity(x.id,o),c("Activity updated successfully!")}else await v.createExtendedActivity(o),c("Activity logged successfully!");q(),setTimeout(()=>{c("")},3e3)}catch(l){console.error("Error logging activity:",l),n("Failed to log activity. Please try again. "+(l instanceof Error?l.message:""))}finally{M(!1)}},X=t=>{W(t),C(t.activityType),A(t.duration.toString()),F(t.distance?.toString()||""),E(t.caloriesBurned?.toString()||""),B(t.notes||""),R(t.date?t.date instanceof Date?t.date.toISOString().split("T")[0]:t.date.toDate().toISOString().split("T")[0]:new Date().toISOString().split("T")[0]),window.scrollTo({top:0,behavior:"smooth"})},V=()=>{q()},Z=async t=>{if(!s){n("User not authenticated.");return}if(confirm("Are you sure you want to delete this activity? This action cannot be undone."))try{await v.deleteExtendedActivity(t),c("Activity deleted successfully!"),x&&x.id===t&&V(),setTimeout(()=>{c("")},3e3)}catch(r){console.error("Error deleting activity:",r),n("Failed to delete activity. "+(r instanceof Error?r.message:""))}},_=()=>{if(i.length===0){n("No activities to export.");return}try{const t={userId:s?.uid,exportDate:new Date().toISOString(),totalActivities:i.length,activities:i.map(l=>({...l,date:l.date?l.date instanceof Date?l.date.toISOString():l.date.toDate().toISOString():null,timestamp:l.timestamp?l.timestamp instanceof Date?l.timestamp.toISOString():l.timestamp.toDate().toISOString():null}))},r=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),p=URL.createObjectURL(r),o=document.createElement("a");o.href=p,o.download=`activities-${s?.uid}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(p),c("Activity data exported successfully!"),setTimeout(()=>c(""),3e3)}catch(t){console.error("Error exporting activities:",t),n("Failed to export activity data. "+(t instanceof Error?t.message:""))}},q=()=>{C("Running"),A(""),F(""),E(""),B(""),R(new Date().toISOString().split("T")[0]),W(null),n("")},ee=()=>{const t=i.reduce((o,l)=>o+l.duration,0),r=i.reduce((o,l)=>o+(l.distance||0),0),p=i.reduce((o,l)=>o+(l.caloriesBurned||0),0);return{totalDuration:parseFloat(t.toFixed(1)),totalDistance:parseFloat(r.toFixed(2)),totalCalories:Math.round(p)}},te=$==="all"?i:i.filter(t=>t.activityType===$),se=["all",...Array.from(new Set(i.map(t=>t.activityType))).sort()],O=ee();return s?e.jsxs("div",{className:"p-6 bg-white rounded-xl shadow-lg w-full max-w-4xl mx-auto mt-8",children:[e.jsx("div",{className:"mb-6 p-4 bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-black",children:["Hello!, ",s.displayName||s.email?.split("@")[0]||"User","!"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["User ID: ",s.uid]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Last sign in: ",s.metadata.lastSignInTime?new Date(s.metadata.lastSignInTime).toLocaleDateString():"Unknown"]})]})]})}),i.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-100 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-black",children:"Activity Summary"}),e.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:_,className:"text-black border-black hover:bg-gray-200",children:"Export Data"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:i.length}),e.jsx("div",{className:"text-black",children:"Total Activities"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:O.totalDuration}),e.jsx("div",{className:"text-black",children:"Total Minutes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:O.totalDistance.toFixed(1)}),e.jsx("div",{className:"text-black",children:"Total Distance (km)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:O.totalCalories}),e.jsx("div",{className:"text-black",children:"Total Calories"})]})]})]}),e.jsxs(k,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(S,{className:"text-black",children:x?"Edit Activity":"Log Your Activity"}),e.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:Y,disabled:b,className:"flex items-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})})]})}),e.jsxs(P,{children:[H&&e.jsx("p",{className:"text-red-500 text-sm mb-4 text-center",children:H}),f&&e.jsx("p",{className:"text-green-600 text-sm mb-4 text-center",children:f}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"activityType",children:"Activity Type"}),e.jsxs(ne,{id:"activityType",value:D,onChange:t=>C(t.target.value),required:!0,children:[e.jsx("option",{value:"Running",children:"Running"}),e.jsx("option",{value:"Strength Training",children:"Strength Training"}),e.jsx("option",{value:"Cycling",children:"Cycling"}),e.jsx("option",{value:"Swimming",children:"Swimming"}),e.jsx("option",{value:"Yoga",children:"Yoga"}),e.jsx("option",{value:"Walking",children:"Walking"}),e.jsx("option",{value:"Hiking",children:"Hiking"}),e.jsx("option",{value:"Basketball",children:"Basketball"}),e.jsx("option",{value:"Soccer",children:"Soccer"}),e.jsx("option",{value:"Tennis",children:"Tennis"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"duration",children:"Duration (minutes)"}),e.jsx(j,{type:"number",id:"duration",value:N,onChange:t=>A(t.target.value),placeholder:"e.g., 30",min:"1",max:"1440",required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"distance",children:"Distance (km, optional)"}),e.jsx(j,{type:"number",id:"distance",value:T,onChange:t=>F(t.target.value),placeholder:"e.g., 5.2",step:"0.1",min:"0"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"caloriesBurned",children:"Estimated Calories Burned (optional)"}),e.jsx(j,{type:"number",id:"caloriesBurned",value:L,onChange:t=>E(t.target.value),placeholder:"e.g., 300",min:"0"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"notes",children:"Notes (optional)"}),e.jsx(J,{id:"notes",rows:3,value:w,onChange:t=>B(t.target.value),placeholder:"e.g., Felt great today! Focused on upper body.",maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[w.length,"/500 characters"]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"activityDate",children:"Date"}),e.jsx(j,{type:"date",id:"activityDate",value:I,onChange:t=>R(t.target.value),max:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{type:"submit",className:"flex-1 bg-black text-white hover:bg-gray-800",disabled:U,children:U?x?"Updating...":"Logging Activity...":x?"Update Activity":"Log Activity"}),x&&e.jsx(u,{type:"button",variant:"outline",onClick:V,disabled:U,children:"Cancel"})]})]})]})]}),e.jsxs("div",{className:"mt-8",children:[i.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx(g,{className:"block mb-2",children:"Filter by Activity Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:se.map(t=>e.jsx(u,{type:"button",variant:$===t?"default":"outline",size:"sm",onClick:()=>K(t),children:t==="all"?"All Activities":t},t))})]}),e.jsx("h3",{className:"text-xl font-bold text-black mb-4 text-center",children:"Your Activities"}),b?e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-black",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-black",children:"Loading your activities..."})]})}):i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsx("h3",{className:"text-lg font-medium text-black mb-2",children:"No activities yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Start your fitness journey by logging your first activity!"}),e.jsx(u,{onClick:()=>document.getElementById("activityType")?.focus(),className:"bg-black text-white hover:bg-gray-800",children:"Log Your First Activity"})]}):e.jsx("div",{className:"space-y-4",children:te.map(t=>e.jsx(k,{className:"bg-white p-4 shadow-sm border border-black",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"text-lg font-semibold text-black",children:t.activityType}),e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-100 text-black",children:t.date?t.date instanceof Date?t.date.toLocaleDateString():t.date.toDate().toLocaleDateString():"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Duration"}),e.jsxs("p",{className:"font-semibold text-black",children:[t.duration," min"]})]}),t.distance!==void 0&&t.distance!==null&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Distance"}),e.jsxs("p",{className:"font-semibold text-black",children:[t.distance.toFixed(2)," km"]})]}),t.caloriesBurned!==void 0&&t.caloriesBurned!==null&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Calories"}),e.jsx("p",{className:"font-semibold text-black",children:t.caloriesBurned})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Logged"}),e.jsx("p",{className:"font-semibold text-black",children:t.timestamp?t.timestamp instanceof Date?t.timestamp.toLocaleDateString():t.timestamp.toDate().toLocaleDateString():"N/A"})]})]}),t.notes&&e.jsx("div",{className:"bg-gray-100 p-3 rounded border-l-4 border-black mb-3",children:e.jsxs("p",{className:"text-sm text-black italic",children:['"',t.notes,'"']})})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>X(t),children:"Edit"}),e.jsx(u,{variant:"default",size:"sm",onClick:()=>t.id&&Z(t.id),className:"bg-black text-white hover:bg-gray-800",children:"Delete"})]})]})},t.id))})]})]}):e.jsx("div",{className:"p-6 bg-white rounded-xl shadow-lg w-full max-w-2xl mx-auto mt-8",children:e.jsxs(k,{children:[e.jsx(z,{children:e.jsx(S,{className:"text-center text-black",children:"Sign In Required"})}),e.jsx(P,{children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-black",children:"Please sign in to log and view your activities."}),e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{variant:"outline",onClick:()=>window.location.href="/signin",children:"Go to Sign In"})})]})})]})})}function ce(){return e.jsxs("div",{className:"min-h-screen flex flex-col bg-white",children:[e.jsx(re,{}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-start p-4",children:[e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-2xl w-full max-w-md border border-black mt-8 text-center",children:[e.jsx("p",{className:"text-lg text-black mb-2",children:"Log your activities here!"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Your data is securely stored in the cloud."})]}),e.jsx(oe,{})]})]})}const ge=ie(ce);export{ge as default};
