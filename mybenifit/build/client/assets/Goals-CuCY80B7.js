import{R as g,j as e,w as X,r as c}from"./chunk-EF7DTUVF-Boj4Qu73.js";import{a as q}from"./firebase-Db5tcxcc.js";import{g as k,f as R}from"./firestore-yvp8jBDT.js";import{N as Z}from"./nav-CVT91Aez.js";const u=g.forwardRef(({className:s,variant:i,size:r,...m},h)=>{const D="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",S={default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},o={default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"};return e.jsx("button",{className:`${D} ${S[i||"default"]} ${o[r||"default"]} ${s||""}`,ref:h,...m})});u.displayName="Button";const T=g.forwardRef(({className:s,type:i,...r},m)=>e.jsx("input",{type:i,className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${s||""}`,ref:m,...r}));T.displayName="Input";const C=g.forwardRef(({className:s,...i},r)=>e.jsx("label",{ref:r,className:`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${s||""}`,...i}));C.displayName="Label";const _=({children:s,...i})=>e.jsx("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",...i,children:s}),E=g.forwardRef(({className:s,...i},r)=>e.jsx("div",{ref:r,className:`rounded-xl border bg-card text-card-foreground shadow ${s||""}`,...i}));E.displayName="Card";const z=g.forwardRef(({className:s,...i},r)=>e.jsx("div",{ref:r,className:`flex flex-col space-y-1.5 p-6 ${s||""}`,...i}));z.displayName="CardHeader";const U=g.forwardRef(({className:s,...i},r)=>e.jsx("h3",{ref:r,className:`font-semibold leading-none tracking-tight ${s||""}`,...i}));U.displayName="CardTitle";const A=g.forwardRef(({className:s,...i},r)=>e.jsx("div",{ref:r,className:`p-6 pt-0 ${s||""}`,...i}));A.displayName="CardContent";function ee(){const[s,i]=c.useState(q.currentUser),[r,m]=c.useState([]),[h,D]=c.useState(!1),[S,o]=c.useState(""),[O,l]=c.useState(""),[F,f]=c.useState("steps"),[p,b]=c.useState(""),[v,j]=c.useState(""),[y,N]=c.useState(""),[L,G]=c.useState(!1),[x,$]=c.useState(null),[w,P]=c.useState(void 0);c.useEffect(()=>{const t=q.onAuthStateChanged(a=>{console.log("Auth state changed:",a?`User ${a.uid} signed in`:"User signed out"),i(a),a&&console.log("User details:",{uid:a.uid,email:a.email,displayName:a.displayName,emailVerified:a.emailVerified})});return()=>t()},[]),c.useEffect(()=>{if(s){B();const t=k.subscribeToUserGoals(s.uid,a=>{m(a)});return()=>t()}else m([])},[s,w]);const B=async()=>{if(!s){l("User not authenticated. Please sign in to view your goals.");return}try{D(!0),l(""),o(""),console.log("Loading goals for user:",s.uid);const t=await k.getGoalsByUser(s.uid,w);console.log("Loaded goals:",t),m(t),t.length===0?o("No goals found. Create your first goal to get started!"):(o(`Successfully loaded ${t.length} goal${t.length===1?"":"s"}`),setTimeout(()=>o(""),3e3))}catch(t){console.error("Error loading goals:",t),t instanceof Error?t.message.includes("permission")?l("Permission denied. Please check your authentication status."):t.message.includes("network")?l("Network error. Please check your internet connection."):l(`Failed to load goals: ${t.message}`):l("Failed to load goals. Please try refreshing the page.")}finally{D(!1)}},M=async t=>{if(t.preventDefault(),l(""),o(""),!s){l("Please sign in to create goals");return}if(!p||!v||!y){l("Please fill in all required fields");return}const a=parseFloat(p),n=parseFloat(v);if(isNaN(a)||isNaN(n)||a<=0){l("Please provide valid numbers");return}try{G(!0);const d={userId:s.uid,type:F,target:a,current:n,startDate:R.now(),targetDate:R.toTimestamp(new Date(y)),achieved:n>=a};await k.createGoal(d),o("Goal created successfully!"),f("steps"),b(""),j(""),N("")}catch(d){console.error("Error creating goal:",d),l("Failed to create goal. Please try again.")}finally{G(!1)}},H=t=>{$(t),f(t.type),b(t.target.toString()),j(t.current.toString()),N(new Date(t.targetDate.toDate()).toISOString().split("T")[0])},W=async t=>{if(t.preventDefault(),l(""),o(""),!s||!x){l("Please sign in to update goals");return}if(!p||!v||!y){l("Please fill in all required fields");return}const a=parseFloat(p),n=parseFloat(v);if(isNaN(a)||isNaN(n)||a<=0){l("Please provide valid numbers");return}try{G(!0);const d={type:F,target:a,current:n,targetDate:R.toTimestamp(new Date(y)),achieved:n>=a};await k.updateGoal(x.id,d),o("Goal updated successfully!"),f("steps"),b(""),j(""),N(""),$(null)}catch(d){console.error("Error updating goal:",d),l("Failed to update goal. Please try again.")}finally{G(!1)}},V=()=>{$(null),f("steps"),b(""),j(""),N(""),l(""),o("")},Y=async t=>{if(s)try{await k.deleteGoal(t),o("Goal deleted successfully!"),x&&x.id===t&&V()}catch(a){console.error("Error deleting goal:",a),l("Failed to delete goal")}},J=()=>{if(r.length===0){l("No goals to export");return}try{const t={userId:s?.uid,exportDate:new Date().toISOString(),totalGoals:r.length,goals:r.map(I=>({...I,startDate:I.startDate.toDate().toISOString(),targetDate:I.targetDate.toDate().toISOString()}))},a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),d=document.createElement("a");d.href=n,d.download=`goals-${s?.uid}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(n),o("Goal data exported successfully!"),setTimeout(()=>o(""),3e3)}catch(t){console.error("Error exporting goals:",t),l("Failed to export goal data")}},K=t=>{const a=t.current/t.target*100;return Math.min(a,100)},Q=t=>t.achieved?"achieved":t.targetDate.toDate()<new Date?"overdue":"in-progress";return s?e.jsxs("div",{className:"min-h-screen flex flex-col bg-white",children:[e.jsx(Z,{}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-start p-4",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl text-black mb-4",children:"Set and Achieve Your Fitness Goals"}),e.jsx("p",{className:"text-md text-gray-700",children:"Track your progress, stay motivated, and reach new milestones!"})]}),e.jsx("div",{className:"w-full max-w-2xl mx-auto mb-6 p-4 bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-black",children:["Come Onn!!!!!, ",s.displayName||s.email?.split("@")[0]||"User","!"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["User ID: ",s.uid]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Last sign in: ",s.metadata.lastSignInTime?new Date(s.metadata.lastSignInTime).toLocaleDateString():"Unknown"]})]})]})}),e.jsx("div",{className:"p-6 bg-white rounded-xl shadow-lg w-full max-w-2xl mx-auto",children:e.jsxs(E,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(U,{className:"text-black",children:x?"Edit Goal":"Create New Goal"}),e.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:B,disabled:h,className:"flex items-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})})]})}),e.jsxs(A,{children:[O&&e.jsx("p",{className:"text-destructive text-sm mb-4 text-center",children:O}),S&&e.jsx("p",{className:"text-green-600 text-sm mb-4 text-center",children:S}),e.jsxs("form",{onSubmit:x?W:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"goalType",children:"Goal Type"}),e.jsxs(_,{id:"goalType",value:F,onChange:t=>f(t.target.value),required:!0,children:[e.jsx("option",{value:"steps",children:"Daily Steps"}),e.jsx("option",{value:"calories",children:"Calories Burned"}),e.jsx("option",{value:"weight",children:"Weight Loss"}),e.jsx("option",{value:"distance",children:"Distance"})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"target",children:"Target Value"}),e.jsx(T,{type:"number",id:"target",value:p,onChange:t=>b(t.target.value),placeholder:"Enter your target value",min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"current",children:"Current Value"}),e.jsx(T,{type:"number",id:"current",value:v,onChange:t=>j(t.target.value),placeholder:"Enter your current value",min:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"targetDate",children:"Target Date"}),e.jsx(T,{type:"date",id:"targetDate",value:y,onChange:t=>N(t.target.value),min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{type:"submit",className:"flex-1 bg-black hover:bg-gray-800",disabled:L,children:L?x?"Updating...":"Creating...":x?"Update Goal":"Create Goal"}),x&&e.jsx(u,{type:"button",variant:"outline",onClick:V,disabled:L,children:"Cancel"})]})]})]})]})}),e.jsxs("div",{className:"w-full max-w-2xl mx-auto mt-8",children:[r.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-100 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-black",children:"Goal Summary"}),e.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:J,className:"text-black border-black hover:bg-gray-200",children:"Export Data"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:r.length}),e.jsx("div",{className:"text-black",children:"Total Goals"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:r.filter(t=>t.achieved).length}),e.jsx("div",{className:"text-black",children:"Achieved"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:r.filter(t=>!t.achieved&&t.targetDate.toDate()>new Date).length}),e.jsx("div",{className:"text-black",children:"In Progress"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:r.filter(t=>!t.achieved&&t.targetDate.toDate()<new Date).length}),e.jsx("div",{className:"text-black",children:"Overdue"})]})]})]}),e.jsxs("div",{className:"mb-4 flex gap-2",children:[e.jsx(u,{type:"button",variant:w===void 0?"default":"outline",size:"sm",onClick:()=>P(void 0),children:"All Goals"}),e.jsx(u,{type:"button",variant:w===!1?"default":"outline",size:"sm",onClick:()=>P(!1),children:"Active Goals"}),e.jsx(u,{type:"button",variant:w===!0?"default":"outline",size:"sm",onClick:()=>P(!0),children:"Achieved Goals"})]}),e.jsx("h3",{className:"text-xl font-bold text-black mb-4 text-center",children:"Your Goals"}),h?e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-black",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-black",children:"Loading your goals..."})]})}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-medium text-black mb-2",children:"No goals yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Start your fitness journey by setting your first goal!"}),e.jsx(u,{onClick:()=>document.getElementById("goalType")?.focus(),className:"bg-black hover:bg-gray-800",children:"Create Your First Goal"})]}):e.jsx("div",{className:"space-y-4",children:r.map(t=>{const a=K(t),n=Q(t);return e.jsx(E,{className:"bg-white p-4 shadow-sm border border-black",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(U,{className:"text-lg font-semibold text-black capitalize",children:[t.type," Goal"]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${n==="achieved"?"bg-gray-200 text-black":n==="overdue"?"bg-gray-300 text-black":"bg-gray-100 text-black"}`,children:n==="achieved"?"Achieved":n==="overdue"?"Overdue":"In Progress"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Target"}),e.jsx("p",{className:"font-semibold text-black",children:t.target})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Current"}),e.jsx("p",{className:"font-semibold text-black",children:t.current})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Progress"}),e.jsxs("p",{className:"font-semibold text-black",children:[a.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Target Date"}),e.jsx("p",{className:"font-semibold text-black",children:t.targetDate.toDate().toLocaleDateString()})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${a>=100?"bg-black":a>=75?"bg-gray-600":a>=50?"bg-gray-400":"bg-gray-300"}`,style:{width:`${Math.min(a,100)}%`}})}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Started: ",t.startDate.toDate().toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>H(t),children:"Edit"}),e.jsx(u,{variant:"destructive",size:"sm",onClick:()=>t.id&&Y(t.id),className:"bg-black text-white hover:bg-gray-800",children:"Delete"})]})]})},t.id)})})]})]})]}):e.jsx("div",{className:"p-6 bg-white rounded-xl shadow-lg w-full max-w-2xl mx-auto mt-8",children:e.jsxs(E,{children:[e.jsx(z,{children:e.jsx(U,{className:"text-center text-black",children:"Sign In Required"})}),e.jsx(A,{children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-black",children:"Please sign in to view and manage your goals."}),e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{variant:"outline",onClick:()=>window.location.href="/signin",children:"Go to Sign In"})})]})})]})})}const le=X(ee);export{le as default};
